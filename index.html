<!DOCTYPE html>
<html>
  <body>
    <script src="graphics.js"></script>
    <script src="board.js"></script>
    <script src="letters.js"></script>
    <script>
      var game;
      var board;
      var scoreCounter;
      var bgimg;
      var running = false;
      var dict;

      function loadDictionary() {
        dict = { };

        var dictFrame = document.getElementById("dictFile");
        var dictRaw = dictFrame.contentWindow.document.body.childNodes[0].innerHTML;
        var lines = dictRaw.split('\n');
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i].trim();
          if (line.length > 2) {
            dict[line] = true;
          }
        }
      }

      function initGameArea() {
        game = new Game(document.getElementById("gameCanvas"), 500, init, update, render);
        scoreCounter = document.getElementById("scoreCounter");
        bgimg = document.getElementById("bgimg");
        window.onkeydown = keyup;

        game.forceRender();
      }

      function startGame() {
        game.run();
        running = true;
      }

      function stopGame() {
        game.stop();
      }

      function init() {
        board = new Board(16, 8, 32);
        board.addTile(0, 0, "A", "blue");
      }

      function update() {
        board.update();
        scoreCounter.innerHTML = "Score: " + board.score;

        if (board.lost) {
          stopGame();
        }
      }

      function render() {
        game.context.drawImage(bgimg, 0, 0);
        if (running) {
          board.render(game);
        } else {
          game.context.fillStyle = "blue";
          game.context.font = "48px Ariel"
          game.context.fillText("Press Space", 45, 256);
        }
      }

      function keydown(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (running) {
          if (key == 37 || key == 65) {
            board.moveActive(-1);
          } else if (key == 39 || key == 68) {
            board.moveActive(1);
          } else if (key == 32) {
            board.dropActive();
          } else if (key == 16) {
            board.swap();
          } else if (key == 82) {
            init();
          }
        } else {
          startGame();
        }


        game.forceRender();
      }

      window.onload = initGameArea;

    </script>

    <iframe id="dictFile" src="dict8.txt" onload="loadDictionary();" style="display: none;"></iframe>
    <img id="bgimg" src="board.png" style="display: none;">
    <h1>Word Tetris</h1>

    <p id="scoreCounter">Score: 0</p>
    <canvas id="gameCanvas" width="320" height="512" style="border: 1px solid black;">


  </body>
</html>
